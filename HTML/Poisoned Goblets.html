<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Poisoned Goblets — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        @font-face {
            font-family: icons;
            src: url(font/Icons\ 2.ttf);
        }
        .dark table, table {
            margin: 1em auto;
            border: none;
        }
        .page-footer::before { content: 'Page '; }
        .page-footer::after { content: ' of 6'; }
        .list2 {
            font-size: 15px;
            font-style: italic;
        }
        .list3 {
            font-size: 15px;
            font-style: italic;
            list-style-type: disc;
        }
        .list21 {
            font-size: 13px;
            font-style: italic;
        }
        .list31 {
            font-size: 13px;
            font-style: italic;
            list-style-type: disc;
        }
        .minititle {
            margin-top: 10%;
            text-decoration: underline;
            font-weight: bold;
            font-size: 20px;
        }
        .pie-outer *, .pie-outer {
            padding: 0;
            margin: 0;
        }
        .pie-outer {
            position: relative;
            padding-top: 90%;
            margin: auto;
            width: 80%;
        }
        .pie {
            pointer-events: none;
            position: absolute;
            top: 50%;
            left: 50%;
            overflow: hidden;
            border: 2px solid #000;
            border-radius: 50%;
        }
        .pie ul {
            list-style-type: none;
        }
        .pie ul:after {
            content: " ";
            display: block;
            width: 100%;
            padding-top: 100%;
        }
        .pie li {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 100%;
            height: 100%;
            margin-left: -2px;
            margin-top: -2px;
            overflow: hidden;
            border: 1px solid #000;
            -webkit-transform-origin: 100% 100%;
            -ms-transform-origin: 100% 100%;
            transform-origin: 100% 100%
        }
        .pie a {
            pointer-events: auto;
            font-size: 2.125vw;
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            text-decoration: none;
            text-align: center;
            color: #000;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        .cell {
            width: 1.2em;
            height: 1.7em;
            font-size: 1.3em;
            line-height: 0px;
            border: 1.5px solid #000;
        }
        .buttonmove {
            width: 1.2em;
            height: 1em;
            font-size: 1.3em;
            line-height: 0px;
            border: 1.5px solid #000;
            cursor: pointer;
        }
        .cellimg {
            font-family: icons;
            font-size: 1em;
            line-height: 0px;
            position: relative;
            top: 0%;
            left: 0%;
        }
        .dark img:not(.diagram), .dark .pie { filter: invert(80%); }
        .print {
            margin: 60px 0;
            display: none;
        }
        @media print {
            .noprint {
                display: none;
            }
            .print {
                display: block;
            }
        }
    </style>
</head>
<body>

    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Poisoned Goblets</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Poisoned Goblets.svg" class="diagram">
                <h2>On the Subject of Poisoned Goblets</h2>
                <p class="flavour-text">I would have never expected to drink some fine wine while defusing a bomb...</p>
                <p>
                    This module consists of 6 buttons representing different goblets, each goblet can be identified by its number and position. 
                    To solve this module you need to find the goblet with the least poison.
                </p>
                <p>
                    First set the diagram to its starting position by rotating all the sections so all numbers points to the goblet
                    with the same one.
                </p>
                <p>
                    Then sum all the numbers on the serial number and repeat the following steps that many times.
                </p>
                    
                    <ol type = "1">
                        <li class = "list2">
                            Convert the first letter of the serial number to its numeric value based on alphabetical
                            order (A=1, B=2... Z=26) and follow the first rule below that applies.
                            <ul>
                                <li class = "list3">
                                    If there is a vowel in the serial number invert 'clockwise' and 'counterclockwise'.
                                </li>
                            </ul>
                        </li>
                        <li class = "list2">
                            After the rule, apply each of its sub-rules to determine in which goblet poison is added.
                        </li>
                        <li class = "list2">
                            Press the central button and go back to the first step, each time using
                            the next letter of the serial number (if you run out of letters loop back to the first one).
                            <ul>
                                <li class = "list3">
                                    If you press the cycle button too many or not enough times an error occurs and the module resets.
                                </li>
                            </ul>
                        </li>
                        <li class = "list2">
                            When you've repeated these steps enough times press the goblet that you think contains the least poison 
                            (in case of a draw, either one is correct).
                        </li>
                    </ol>

                <p>
                    <br>
                    Note: In the diagram below each circle or section is numbered from outer to inner,
                    so the outer one would be the first and the inner one would be the fourth.
                    Also the diagram has 6 slices or columns just like the chalices, so you can tell which
                    chalice points to that column.
                </p>              
            </div>
            <div class="page-footer relative-footer">1</div>
        </div>

        <div class="page page-bg-06">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Poisoned Goblets</span>
            </div>
            <div class="page-content">    
                <h3>Rules:</h3>
                <ol type = "1">
                    <li class = "list21">
                        If the number is prime move the third and fourth sections once counterclockwise, instead
                        move the first and second if there's at least one parallel port.
                        <ul>
                            <li class = "list31">
                                If there's more than one unlit indicator, 1 poison is added to each goblet pointing to a column with a heart.
                            </li>
                            <li class = "list31">
                                If all the stars on the diagram are in the same column, 2 poisons are added to the goblet pointing to that column.
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise if the number is divisible by 7 move the first section twice clockwise.
                        <ul>
                            <li class = "list31">
                                1 poison is added to the goblet pointing to the space with the most flowers (in case of a draw poison is added to each of those goblets).
                            </li>
                            <li class = "list31">
                                If there are more than three ports, 1 poison is added to each goblet pointing to a column with at least one star.
                            </li>
                            <li class = "list31">
                                Otherwise 1 poison is removed from each goblet pointing to a column with at least one spiral and no stars;
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise if the number is divisible by 11 move the fourth section clockwise a number of times equal to the number
                        of AA batteries on the bomb.
                        <ul>
                            <li class = "list31">
                                If there are more AA batteries than D batteries, 2 poisons are added to each goblet pointing to a column with no flowers.
                            </li>
                            <li class = "list31">
                                Otherwise 1 poison is added to each goblet pointing to a column with at least one star.
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise if the number is divisible by 9 move the second section once counterclockwise,
                        once again if there is a CAR or SIG indicator.
                        <ul>
                            <li class = "list31">
                                If there's a PS/2 port, 3 poisons are added to the goblet pointing to the column with the skull.
                            </li>
                            <li class = "list31">
                                If both spirals are in the same column, 2 poisons are removed from the goblet pointing to that column.
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise if the number is divisible by 5 move the third section clockwise once, also 
                        move the first section counterclockwise once if there is at least one lit indicator.
                        <ul>
                            <li class = "list31">
                                1 poison is added to the goblet pointing to the column with the most flowers (in case of draw poison is added to each of those goblets).
                            </li>
                            <li class = "list31">
                                If there's an unlit IND or SND indicator, 1 poison is added to each goblet pointing to a column with no hearts.
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise if the number is divisible by 2 move the second section counterclockwise once, also 
                        move the first and fourth sections clockwise once if there are more ports than batteries.
                        <ul>
                            <li class = "list31">
                                If all the stars on the diagram are in the same column, 1 poison is added to the goblet pointing to that column.
                            </li>
                            <li class = "list31">
                                Otherwise if there's a column on the diagram that contains the skull and a heart, 2 poisons are added to the goblet pointing to that column.
                            </li>
                            <li class = "list31">
                                1 poison is added to each goblet pointing to a column with at least 3 flowers.
                            </li>
                        </ul>
                    </li>
                    <li class = "list21">
                        Otherwise move everything clockwise once.
                        <ul>
                            <li class = "list31">
                                1 poison is added to each goblet not pointing to a column with a skull.
                            </li>
                            <li class = "list31">
                                1 poison is removed from each goblet not pointing to a column with at least one spiral.
                            </li>
                        </ul>
                    </li>
                </ol>
            </div>
            <div class="page-footer relative-footer">2</div>
        </div>

        <div class="page page-bg-04">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Poisoned Goblets</span>
            </div>
            <div class="page-content" id="page2">
                <h3>Digital manual instructions:</h3>
                <p>
                    These pages are only used if you are using the digital manual.
                    Use the arrows below to move the diagram sections.
                </p>
                <table>
                    <tr>
                        <th onclick="MoveCells(-1, 0)" class="buttonmove">&lt;</th>
                        <th onclick="MoveCells(1, 0)" class="buttonmove">&gt;</th>
                    </tr>
                    <tr>
                        <th onclick="MoveCells(-1, 1)" class="buttonmove">&lt;</th>
                        <th onclick="MoveCells(1, 1)" class="buttonmove">&gt;</th>
                    </tr>
                    <tr>
                        <th onclick="MoveCells(-1, 2)" class="buttonmove">&lt;</th>
                        <th onclick="MoveCells(1, 2)" class="buttonmove">&gt;</th>
                    </tr>
                    <tr>
                        <th onclick="MoveCells(-1, 3)" class="buttonmove">&lt;</th>
                        <th onclick="MoveCells(1, 3)" class="buttonmove">&gt;</th>
                    </tr>
                    <tr>
                        <th onclick="Reset()" class="buttonmove" colspan="2">Reset</th>
                    </tr>
                </table>
                <div class="print"><img src="img/Poisoned Goblets/X.png" style="width: 80%; display:block; margin: auto;"></div>
            </div>
            <div class="page-footer relative-footer">3</div>
        </div>

        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Poisoned Goblets</span>
            </div>
            <div class="page-content">
                <h3>Printable manual instructions:</h3>
                <p>
                    These pages are only used if you are not using the digital manual.
                    Print the following 2 pages and cut out the 4 circles, make a small hole in each one in the middle
                    and use a brad pin to put them together, starting with the smallest in the front and ending with the biggest at the bottom.
                </p>
                <img src="img/Poisoned Goblets/1.png" style="width: 643px;">
            </div>
            <div class="page-footer relative-footer">4</div>
        </div>

        <div class="page page-bg-06">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Poisoned Goblets</span>
            </div>
            <div class="page-content">
                <img src="img/Poisoned Goblets/2.png" style="width: 480px;">
                <img src="img/Poisoned Goblets/3.png" style="width: 336px;">
                <img src="img/Poisoned Goblets/4.png" style="width: 200px;">
            </div>
            <div class="page-footer relative-footer">5</div>
        </div>

        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Appendix Alphabet</span>
            </div>
            <div class="page-content">
                <h2>Appendix Alphabet: Alphabet References</h2>
                <p class="minititle">Alphabetical Order</p>
                <table>
                    <tr>
                        <th class="cell">A</th>
                        <th class="cell">B</th>
                        <th class="cell">C</th>
                        <th class="cell">D</th>
                        <th class="cell">E</th>
                        <th class="cell">F</th>
                        <th class="cell">G</th>
                        <th class="cell">H</th>
                        <th class="cell">I</th>
                        <th class="cell">J</th>
                        <th class="cell">K</th>
                        <th class="cell">L</th>
                        <th class="cell">M</th>
                    </tr>
                    <tr>
                        <th class="cell">1</th>
                        <th class="cell">2</th>
                        <th class="cell">3</th>
                        <th class="cell">4</th>
                        <th class="cell">5</th>
                        <th class="cell">6</th>
                        <th class="cell">7</th>
                        <th class="cell">8</th>
                        <th class="cell">9</th>
                        <th class="cell">10</th>
                        <th class="cell">11</th>
                        <th class="cell">12</th>
                        <th class="cell">13</th>
                    </tr>
                </table>
                <table>
                    <tr>
                        <th class="cell">N</th>
                        <th class="cell">O</th>
                        <th class="cell">P</th>
                        <th class="cell">Q</th>
                        <th class="cell">R</th>
                        <th class="cell">S</th>
                        <th class="cell">T</th>
                        <th class="cell">U</th>
                        <th class="cell">V</th>
                        <th class="cell">W</th>
                        <th class="cell">X</th>
                        <th class="cell">Y</th>
                        <th class="cell">Z</th>
                    </tr>
                    <tr>
                        <th class="cell">14</th>
                        <th class="cell">15</th>
                        <th class="cell">16</th>
                        <th class="cell">17</th>
                        <th class="cell">18</th>
                        <th class="cell">19</th>
                        <th class="cell">20</th>
                        <th class="cell">21</th>
                        <th class="cell">22</th>
                        <th class="cell">23</th>
                        <th class="cell">24</th>
                        <th class="cell">25</th>
                        <th class="cell">26</th>
                    </tr>
                </table>
            </div>
            <div class="page-footer relative-footer">6</div>
        </div>
    </div>

    <script>
        /*
        A = teschio
        B = spirale
        C = stelle3
        D = stelle2
        E = stelle1
        F = fiori3
        G = fiori2
        H = fiori9
        I = cuori3
        */
        let data = [
            ["J", "I", "B", "F", "C", "I"],
            ["K", "H", "G", " ", "H", "D"], 
            ["L", " ", " ", "B", " ", "G"], 
            ["M", " ", " ", " ", " ", " "]];
        let dataSize = [
            [4.2, 3, 1, 3, 3, 3],
            [0.35, 1, 2, 1, 1, 2], 
            [1.8, 1, 1, 1, 1, 2], 
            [1.4, 1, 1, 1, 1, 1]];
        let dataSpacing = [
            [0.5, 0.5, 1.5, 0.5, 0.5, 0.5],
            [1.4, 1.4, 0.7, 1.4, 1.4, 0.7], 
            [1.4, 1.4, 1.4, 1.4, 1.4, 0.7], 
            [1.4, 1.4, 1.4, 1.4, 1.4, 1.4]];
        let dataLeft = [
            [5, 0, 0, 0, 0, 0],
            [20, 0, 0, 0, 0, 0], 
            [7, 0, 0, 0, 0, 0],
            [6, 0, 0, 0, 0, 0]];
        let dataTop = [
            [-1.5, 0, 0, 0, 0, 0],
            [5.5, 0, 0, 0, 0, 0],
            [-6, 0, 0, 0, 0, 0],
            [-2, 0, 0, 0, 0, 0]];

        const cells = 6;
        const rows = 4;

        createPieMenu();
        function createPieMenu() {
            let pieMenu = document.createElement("div");
            pieMenu.id = "pie-menu"
            pieMenu.classList.add("noprint");
            pieMenu.classList.add("pie-outer");
     
            let widthPercentage = 100;
            const widthDelta = 20;

            for (let i = 0; i < rows; i++) {
                let segmentAngle = (Math.PI * 2) / cells;
                let skewAngle = (Math.PI/2) - segmentAngle;

                let pie = document.createElement("div");
                let pieRotateAngle = (Math.PI/2) - segmentAngle/2;
                pie.classList.add("pie");
                pie.style.width = `${widthPercentage}%`;
                pie.style.transform = `translate(-50%,-50%) rotate(${pieRotateAngle}rad)`;
                let pieList = document.createElement("ul");

                for (let j = 0; j < cells; j++) {
                    let rotationAngle = segmentAngle * j;
                    let pieListItem = document.createElement('li');
                    let pieItemAnchor = document.createElement('a');

                    pieListItem.style.transform = `rotate(${rotationAngle}rad) skew(${skewAngle}rad)`;
                    let textAnchor = document.createElement('p');
                    textAnchor.id = "cell" + i + j;
                    textAnchor.className = "cellimg";
                    textAnchor.style.fontSize = dataSize[i][j].toString() + "em";
                    textAnchor.style.lineHeight = dataSpacing[i][j].toString() + "em";
                    textAnchor.style.left = dataLeft[i][j].toString() + "%";
                    textAnchor.style.top = dataTop[i][j].toString() + "%";
                    textAnchor.innerHTML = data[i][j].toString();
                    pieItemAnchor.appendChild(textAnchor);          
                    let anchorRotate = segmentAngle / 2 - Math.PI / 2;
                    let anchorSkew = segmentAngle - Math.PI / 2;
                    pieItemAnchor.style.transform = `skew(${anchorSkew}rad) rotate(${anchorRotate}rad)`;
                    pieListItem.appendChild(pieItemAnchor);
                    pieList.appendChild(pieListItem)
                }
                pie.appendChild(pieList);
                pieMenu.appendChild(pie);
                widthPercentage -= widthDelta;
            }

            document.getElementById("page2").appendChild(pieMenu);
        }  
        
        function MoveCells(dir, row) {
            if (dir == 1) {
                let x = data[row][data[row].length - 1]; 
                data[row][5] = data[row][4];
                data[row][4] = data[row][3];
                data[row][3] = data[row][2];
                data[row][2] = data[row][1];
                data[row][1] = data[row][0]; 
                data[row][0] = x;

                x = dataSpacing[row][dataSpacing[row].length -1]; 
                dataSpacing[row][5] = dataSpacing[row][4];
                dataSpacing[row][4] = dataSpacing[row][3];
                dataSpacing[row][3] = dataSpacing[row][2];
                dataSpacing[row][2] = dataSpacing[row][1];
                dataSpacing[row][1] = dataSpacing[row][0]; 
                dataSpacing[row][0] = x;

                x = dataSize[row][dataSize[row].length -1]; 
                dataSize[row][5] = dataSize[row][4];
                dataSize[row][4] = dataSize[row][3];
                dataSize[row][3] = dataSize[row][2];
                dataSize[row][2] = dataSize[row][1];
                dataSize[row][1] = dataSize[row][0]; 
                dataSize[row][0] = x;

                x = dataLeft[row][dataLeft[row].length -1]; 
                dataLeft[row][5] = dataLeft[row][4];
                dataLeft[row][4] = dataLeft[row][3];
                dataLeft[row][3] = dataLeft[row][2];
                dataLeft[row][2] = dataLeft[row][1];
                dataLeft[row][1] = dataLeft[row][0]; 
                dataLeft[row][0] = x;

                x = dataTop[row][dataTop[row].length -1]; 
                dataTop[row][5] = dataTop[row][4];
                dataTop[row][4] = dataTop[row][3];
                dataTop[row][3] = dataTop[row][2];
                dataTop[row][2] = dataTop[row][1];
                dataTop[row][1] = dataTop[row][0]; 
                dataTop[row][0] = x;
            }
            else if (dir == -1) {
                let x = data[row][0]; 
                data[row][0] = data[row][1];
                data[row][1] = data[row][2];
                data[row][2] = data[row][3];
                data[row][3] = data[row][4];
                data[row][4] = data[row][5];
                data[row][5] = x;

                x = dataSpacing[row][0]; 
                dataSpacing[row][0] = dataSpacing[row][1];
                dataSpacing[row][1] = dataSpacing[row][2];
                dataSpacing[row][2] = dataSpacing[row][3];
                dataSpacing[row][3] = dataSpacing[row][4];
                dataSpacing[row][4] = dataSpacing[row][5];
                dataSpacing[row][5] = x;

                x = dataSize[row][0]; 
                dataSize[row][0] = dataSize[row][1];
                dataSize[row][1] = dataSize[row][2];
                dataSize[row][2] = dataSize[row][3];
                dataSize[row][3] = dataSize[row][4];
                dataSize[row][4] = dataSize[row][5];
                dataSize[row][5] = x;

                x = dataLeft[row][0]; 
                dataLeft[row][0] = dataLeft[row][1];
                dataLeft[row][1] = dataLeft[row][2];
                dataLeft[row][2] = dataLeft[row][3];
                dataLeft[row][3] = dataLeft[row][4];
                dataLeft[row][4] = dataLeft[row][5];
                dataLeft[row][5] = x;

                x = dataTop[row][0]; 
                dataTop[row][0] = dataTop[row][1];
                dataTop[row][1] = dataTop[row][2];
                dataTop[row][2] = dataTop[row][3];
                dataTop[row][3] = dataTop[row][4];
                dataTop[row][4] = dataTop[row][5];
                dataTop[row][5] = x;
            }

            for (let i = 0; i < rows; i++) 
                for (let j = 0; j < cells; j++)  {
                    let textAnchor = document.getElementById("cell" + i + j);
                    textAnchor.innerHTML = data[i][j].toString();
                    textAnchor.style.fontSize = dataSize[i][j].toString() + "em";
                    textAnchor.style.lineHeight = dataSpacing[i][j].toString() + "em";
                    textAnchor.style.left = dataLeft[i][j].toString() + "%";
                    textAnchor.style.top = dataTop[i][j].toString() + "%";
                }
        }

        function Reset() {
            location.reload();
        }
    </script>
</body>
</html>