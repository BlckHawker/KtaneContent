<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>七中四選 — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/jquery.3.7.0.min.js"></script>
    <script src="js/Utilities/svg-utils.js"></script>
    <script>
    $(function() {
        let grid = $(".gridholder");
        let svg = MakeSvgTag(430,412).appendTo(grid);

        let rows = 4;
        let cols = 4;
        let h = 100;
        let w = 103.5;
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                let cell = MakeSvgElem("rect", {
                    class: "highlightable", x:(11+c*w), y:(3+r*h),
                    width:w, height:h, fill:"transparent"
                });
                svg.append(cell);
            }
        }
    });
    </script>
    <style>
        .dark table, table { border: none; }
        .linestable { width: 60%; }
        .dark .linestable { filter: invert(87%); }
        .gridholder {
            position: relative;
            width: 80%;
            height: 430px;
        }
        .gridholder img, .gridholder svg {
            position: absolute;
            width: 80%;
        }
        @media screen and (width < 900px) {
            .gridholder { height: 515px; }
        }
    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Seven Choose Four.svg" class="diagram">
                <h2>モジュール詳細：七中四選</h2>
                <p class="flavour-text">えっ... これが君の好きな色？青ね。ダメ！黄色しか勝たああああああん！</p>

                <p>このモジュールは四つのピンクのボタンがあり、それぞれの真横で点滅している色がある。</p>

                <h3>解除のヒント</h3>
                <ul>
                    <li>このモジュールを解除するには、4つの4桁の数字コードを順番に入力する必要がある。入力する各4桁のコードはシーケンス番号が割り当てられる。一番目に入力する4桁の数字コードはシーケンス番号1、二番目は2のようになる。</li>
                    <li>上から下に並んだボタンには、それぞれの真横で点滅している色がある。</li>
                    <li>点滅している色は4つの「キー」に変換される。それぞれのキーは英字1文字である。</li>
                    <li>各点滅は「モールス信号、タップコード、色シーケンス、1から7秒間の長い点滅」のどれか一つに則る。</li>
                    <li>モールス信号とタップコードは、通常の手順(<a href="Morse Code translated (日本語 — モールス信号).html">モールス信号</a>や<a href="Tap Code translated (日本語 — タップ・コード) (hatosable).html">タップコード</a>のマニュアルを参照)で解読する。これが、<strong>モールス・キー</strong>や<strong>タップ・キー</strong>となる。</li>
                    <li>色シーケンスはボタンに関連する4つの色に対応している。ボタンは上から下の順番で読む。また、五番目の色は<strong>カラー・キー</strong>である。<strong>カラー・キー</strong>の色名の頭文字を英字として使用する。</li>
                    <li>最後のコードは、単純に1から7の点滅時間を使用する。この点滅はモールス信号のダッシュよりも長く、モールス信号と区別が付くようになっている。<strong>ナンバー・キー</strong>は、リスト「<strong>R G B M C Y W</strong>」の[得た数字]番目の英字である。</li>
                    <li>四つのキーを取得したら、これらのキーを入力として使い、各色を数字4桁のコードに変換する。</li>
                    <li>4桁の数字コードは、各ボタンに対応する色についてのみ求めればよい。</li>
                    <li>コードの送信順は、上から下へ読んだ色の順番、つまり色シーケンスの先頭4色と同じである。</li>
                    <li>一番目の色に使うキーは<strong>カラー・キー</strong>である。残りのキーの順番は、<strong>カラー・キー</strong>のある位置から下に読み、必要に応じて一番上にループして続いていく。</li>
                    <li>各色から4桁の数字コードを求める手順は、以下に記されている。</li>
                </ul>
            </div>
            <div class="page-footer relative-footer">ページ 1/7</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <ul>
                    <li>コードを送信できる準備ができたら、以下の内容を把握しておくこと。
                        <ul>
                            <li>4桁の数字コードを入力する際、ボタンは現在の色に関連するボタンから順に1～4の番号が割り当てられ、必要に応じてループする。</li>
                            <li>モジュールは、4桁の数字コードを送信した後のみミスの判定を行う。ミスが記録された場合、現在の色のコードは削除され再度入力し直す必要がある。</li>
                            <li>4桁の数字コードが正しく送信された場合、その色に対応するボタンが緑色になる。四つのボタンすべてが緑色になると、モジュールは解除される。</li>
                        </ul>
                    </li>
                </ul>
                <h3>赤(Red)</h3>
                <ol>
                    <li>アルファベット上の位置の数字(A = 1,...)を使用して、入力のキーを二桁の数字に変換する。</li>
                    <li>数字が10未満の場合、先頭に0を付ける(01, 02,...など)。</li>
                    <li>この数字に、名前に<strong>R</strong>が含まれる爆弾上のポートの個数を足す(※)。その数字が99を超える場合、下二桁を使用する。</li>
                    <li>二つの各桁に対し、その桁の数字が奇数の場合はそれを1に変換し、偶数の場合は0に変換する。</li>
                    <li>下の論理ゲート表から使用すべき論理ゲートを特定する。シーケンス番号は現在求めている4桁の数字コードの番号に対応する。</li>
                    <li>1を真、0を偽として、二桁の数字を論理ゲートの入力に使用する(論理ゲートについては、付録Aを参照する)。</li>
                    <li>そして、論理ゲートの出力に基づいて、表の中から目的のコードを探す。</li>
                </ol>
                <p class="comment">※ ポートの英名は<a href="./Ports.html">このページ</a>を参照すること。</p>

                <table class="center">
                    <tr><td class='corner'></td><th colspan="4">シーケンス番号</th></tr>
                    <tr><th class='corner'></th><th>1</th><th>2</th><th>3</th><th>4</th></tr>
                    <tr><th>論理ゲート</th><th>NOR</th><th>XOR</th><th>OR</th><th>AND</th></tr>
                    <tr><th>真</th><td>1423</td><td>2314</td><td>4123</td><td>2341</td></tr>
                    <tr><th>偽</th><td>2313</td><td>4231</td><td>2233</td><td>1231</td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 2/7</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <h3>緑(Green)</h3>
                <ol>
                    <li>アルファベット上の位置の数字(A = 1,...)を使用して、入力のキーを二桁の数字に変換する。</li>
                    <li>数字が10未満の場合、先頭に0を付ける(01, 02,...など)。</li>
                    <li>各桁の数字にシリアルナンバーにある「G」と「7」の個数を足し、各桁の数字をそれを4で割った余りにする。</li>
                    <li>二つの桁から得られる4通りの組み合わせを段と列に使用(左上が0,0)し、<strong>ライン表</strong>内の四つのセルを見つける(例：AB => AA, AB, BA, BB)。</li>
                    <li>四つのセルに含まれる線の数を足し合わせ、この情報を使用して下の表から4桁の数字コードを求める。</li>
                    <li>現在のシーケンス番号に対応する組み合わせを取得する。数えた線の本数が偶数であれば、取得したコードを逆順にする。</li>
                </ol>

                <h3>ライン表</h3>
                <div class="gridholder"><img class="linestable" src="img/Seven Choose Four/Lines Table.png"></div>

                <table class="center">
                    <tr><th colspan="4">シーケンス番号</th></tr>
                    <tr><th>1</th><th>2</th><th>3</th><th>4</th></tr>
                    <tr><td>3241</td><td>1122</td><td>4332</td><td>1231</td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 3/7</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <h3>青(Blue)</h3>
                <ol>
                    <li>アルファベット上の位置の数字(A = 1,...)を使用して、入力のキーを二桁の数字に変換する。</li>
                    <li>1-5の範囲になるまで、値から5を引く。これが段番号である。</li>
                    <li>列については、まずシリアルナンバーにあるAからEの範囲に含まれる英字のうち最も先頭にあるものを見つける。そのような英字がない場合、段番号を英字に変換(A = 1,...)し、この英字を列に使用する。</li>
                    <li>この座標は、下のグリッドの開始位置である。</li>
                    <li>最初に、グリッドの縁にぶつかるまでに最も長い距離を移動できる方向を見つける。最長の方向が複数ある場合、北から時計回りの順で優先される。</li>
                    <li>この方向に、爆弾の単3バッテリーの個数だけ進む。</li>
                    <li>その後、同率の優先度を南から反時計回りにしたステップ5のルールに従い、爆弾の単1バッテリーの個数だけ進む。</li>
                    <li>到達したセルに目的の4桁の数字コードがある。</li>
                </ol>

                <table class="center">
                    <tr><th class='corner'></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th></tr>
                    <tr><th>1</th><td>1234</td><td>1243</td><td>2134</td><td>2143</td><td>3124</td></tr>
                    <tr><th>2</th><td>3142</td><td>1324</td><td>1342</td><td>1423</td><td>1432</td></tr>
                    <tr><th>3</th><td>4123</td><td>4132</td><td>2314</td><td>2341</td><td>3214</td></tr>
                    <tr><th>4</th><td>3241</td><td>2413</td><td>2431</td><td>4213</td><td>4231</td></tr>
                    <tr><th>5</th><td>3412</td><td>3421</td><td>4312</td><td>4321</td><td>1234</td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 4/7</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <h3>マゼンタ(Magenta)</h3>
                <ol>
                    <li>以下のグリッドからキーの英字を見つける。</li>
                    <li>シリアルナンバーの先頭四文字もグリッドから見つける。数字は英字に変換する(A=0,B=1)。</li>
                    <li>上下左右のみ(斜めは禁止)の移動で、キーの英字からシリアルナンバーの各文字まで最短経路で移動する際の移動数を求める。</li>
                    <li>文字に到達するたびにキーの英字からやり直し、移動数は1-4の範囲になるように4を足し引きすること。</li>
                    <li>変更後の移動数をシリアルナンバーの順に並べる。これが4桁の数字コードである。</li>
                    <li>必要に応じ、グリッド内のAはZに置き換えて解釈する。</li>
                </ol>

                <table class="center">
                    <tr><th>L</th><th>P</th><th>R</th><th>I</th><th>S</th></tr>
                    <tr><th>X</th><th>O</th><th>F</th><th>B</th><th>V</th></tr>
                    <tr><th>A</th><th>Y</th><th>D</th><th>C</th><th>T</th></tr>
                    <tr><th>K</th><th>G</th><th>W</th><th>Q</th><th>N</th></tr>
                    <tr><th>M</th><th>E</th><th>U</th><th>H</th><th>J</th></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 5/7</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <h3>シアン(Cyan)</h3>
                <ol>
                    <li>キーの英字を数字(A=1,B=2,...)に変換し、1から7の範囲になるまで7を引く。</li>
                    <li>この数字は、リスト「<strong>R G B M C Y W</strong>」の[得た数字]番目の英字が名前の頭文字である色に対応している。</li>
                    <li>他に3つの色を求める必要があり、これはモジュール上の他3つのボタンに対応する色を使用する。</li>
                    <li>4つの色内の原色の数と二次色の数から2つの値を取得し、それを連結して最終的な数字コードを得る。二次色の2桁の前に原色の2桁を設定する(<strong>XXYY</strong>)。</li>
                    <li><strong>P</strong>は原色であり<strong>S</strong>は二次色である。原色と二次色を数える際には、<strong>R G B W</strong>は原色、<strong>M C Y W</strong>は二次色とする。</li>
                </ol>

                <table class="center">
                    <tr><th>#P</th><th>XX</th><th>#S</th><th>YY</th></tr>
                    <tr><th>1P</th><td>13</td><th>4S</th><td>14</td></tr>
                    <tr><th>3P</th><td>42</td><th>0S</th><td>34</td></tr>
                    <tr><th>4P</th><td>43</td><th>1S</th><td>23</td></tr>
                    <tr><th>0P</th><td>12</td><th>3S</th><td>24</td></tr>
                    <tr><th>2P</th><td>13</td><th>2S</th><td>31</td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 6/7</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">七中四選</span>
            </div>
            <div class="page-content">
                <h3>黄色(Yellow)</h3>
                <ol>
                    <li>4桁の数字コードを求めるには、キーに応じて<strong>YELLOW</strong>を使用した特殊な暗号方式を使用する。</li>
                    <li>まず、<strong>YELLOW</strong>に含まれる英字のうち、キーの英字とアルファベット上の位置が最も近い英字を<strong>YELLOW</strong>から除外する。最も近い英字が複数ある場合、アルファベット順で優先される。取り除くべき英字が<strong>L</strong>の場合、一文字だけ除外する。</li>
                    <li>キーの反転英字(A->Z,B->Y,C->X)を求め、キーの英字をその英字に読み替えてステップ2を実行する。</li>
                    <li><strong>YELLOW</strong>に含まれる4つの英字があるはずである。この文字列をシーケンス番号だけ右にずらす。右端の英字は左端にループする。</li>
                    <li>アルファベット順で英字を1-4の数字に変換する(例：AFDH = 1324)。これが答えである。</li>
                </ol>

                <h3>白(White)</h3>
                <ul>
                    <li>白以外の6色のどれか一色を選択し、この色のキーや現在のシーケンス番号を使用して4桁の数字コードを求める。どの4桁の数字コードでもこの色の回答として受け入れられる。</li>
                    <li><strong>注意：</strong>この4桁の数字コードは、異なるキーを使用し新しいシーケンス番号に対応するため、ある色によって生成される4桁のコードが常に同じになる可能性は極めて低く、モジュール上の別の色から求めて入力したコードと同じものを入力しても機能しない可能性が高い！</li>
                </ul>

                <h3>付録A</h3>
                <table class="center">
                    <tr><th rowspan="2">十進数</th><th rowspan="2">二進数</th><th colspan="4">論理ゲート</th></tr>
                    <tr><th>NOR</th><th>XOR</th><th>OR</th><th>AND</th></tr>
                    <tr><td>0</td><td>00</td><td>1</td><td>0</td><td>0</td><td>0</td></tr>
                    <tr><td>1</td><td>01</td><td>0</td><td>1</td><td>1</td><td>0</td></tr>
                    <tr><td>2</td><td>10</td><td>0</td><td>1</td><td>1</td><td>0</td></tr>
                    <tr><td>3</td><td>11</td><td>0</td><td>0</td><td>1</td><td>1</td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">ページ 7/7</div>
        </div>
    </div>
</body>
</html>