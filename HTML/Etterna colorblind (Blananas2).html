<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Etterna — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/ruleseed.js"></script>
    <style>
        .dark table, table { 
            margin: 1em auto;
            text-align: center;
            border: none;
        }
        .dark th.black, th.black {
            background-color: #000000;
            color: white;
            -webkit-backface-visibility: hidden;
        }
        .dark th, th {
            border: 2px solid black;
            color: #000;
            max-width: 2.5em;
        }

        .red { background-color: #FF3333; }
        .blue { background-color: #3366FF; }
        .green { background-color: #33FF33; }
        .yellow { background-color: #FFFF33; }
        .magenta { background-color: #FF33FF; }
        .orange { background-color: #FF9933; }
        .cyan { background-color: #33FFFF; }
        .gray { background-color: #999999; }

        .cb {
            font-size: 7pt;
        }
    </style>
    <script>
        default_colors = [
            "red","gray","cyan","orange",
            "magenta","gray","yellow","gray",
            "green","orange","cyan","gray",
            "blue","gray","cyan","orange",
            "green","gray","yellow","gray",
            "magenta","orange","cyan","gray",
            "red","gray","cyan","orange",
            "magenta","gray","yellow","gray"
        ];
        function ordinal(num) {
            if((Math.abs(num) % 100) >= 11 && (Math.abs(num) % 100) <= 13)
                return num + "th";
            switch (Math.abs(num) % 10) {
                case 1:
                    return num + "st";
                case 2:
                    return num + "nd";
                case 3:
                    return num + "rd";
            }
            return num + "th";
        }
        function range(min, exmax) {
            return [...Array(exmax - min).keys()].map(i => i + min);
        }
        function setDefaultRules() {
            setColors(default_colors);
            document.querySelector("#flavor").innerText = "96ths";

        }
        function setRules(seed) {
            setColors(seed.shuffleArray(default_colors));
            document.querySelector("#flavor").innerText = ordinal(seed.seed);
        }
        function setColors(colors) {
            document.querySelector("#notes").innerHTML = `
                <tr><th colspan="14" class="black"></th></tr>
                <tr>
                    <th class="black"></th>
                    ${range(1, 13).map(i => `<th class="${colors[i - 1]}">${i}<br><span class="cb">${colors[i - 1]}</span></th>`).join("")}
                    <th class="black"></th>
                </tr>
                <tr>
                    <th class="black"></th>
                    ${range(13, 25).map(i => `<th class="${colors[i - 1]}">${i}<br><span class="cb">${colors[i - 1]}</span></th>`).join("")}
                    <th class="black"></th>
                </tr>
                <tr>
                    <th class="black"></th>
                    ${range(25, 33).map(i => `<th class="${colors[i - 1]}">${i}<br><span class="cb">${colors[i - 1]}</span></th>`).join("")}
                    <th colspan="4" class="black">Note Sequence</th>
                    <th class="black"></th>
                </tr>
                <tr><th colspan="14" class="black"></th></tr>
            `;
        }
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Etterna</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Etterna.svg" class="diagram">
                <h2>On the Subject of Etterna</h2>
                <p class="flavour-text">Why does this version of “Ideal Sync ogg” require you to hit <span
                        id="flavor">96ths</span> notes in
                    time?</p>

                <p>The module has a screen with 4 colored arrows and a bar.</p>

                <p>Press the screen when you are ready to input. A 4-beat anacrusis* is played before the 32 beat
                    sequence begins.
                    Proceed to time successive presses as the module cycles through beats 1–32.
                    <strong>Mistiming any beat will give a strike when the cycle ends!</strong>
                </p>

                <p>Gather all arrows from bottom to top and use the table to find the lowest value
                    that shares the color with the bottom-most arrow.
                    Continue by finding the lowest value that shares color with the next arrow,
                    but has a higher value than the one from the previous arrow.</p>

                <p>Repeat this process until you have gathered 4 numbers from the 4 arrows.
                    Proceed to press the screen to start calibration and input the 4 values.</p>
                <br>
                <table id="notes">
                    <tr>
                        <th colspan="14" class="black"></th>
                    </tr>
                    <tr>
                        <th class="black"></th>
                        <th class="red">1</th>
                        <th class="gray">2</th>
                        <th class="cyan">3</th>
                        <th class="orange">4</th>
                        <th class="magenta">5</th>
                        <th class="gray">6</th>
                        <th class="yellow">7</th>
                        <th class="gray">8</th>
                        <th class="green">9</th>
                        <th class="orange">10</th>
                        <th class="cyan">11</th>
                        <th class="gray">12</th>
                        <th class="black"></th>
                    </tr>
                    <tr>
                        <th class="black"></th>
                        <th class="blue">13</th>
                        <th class="gray">14</th>
                        <th class="cyan">15</th>
                        <th class="orange">16</th>
                        <th class="green">17</th>
                        <th class="gray">18</th>
                        <th class="yellow">19</th>
                        <th class="gray">20</th>
                        <th class="magenta">21</th>
                        <th class="orange">22</th>
                        <th class="cyan">23</th>
                        <th class="gray">24</th>
                        <th class="black"></th>
                    </tr>
                    <tr>
                        <th class="black"></th>
                        <th class="red">25</th>
                        <th class="gray">26</th>
                        <th class="cyan">27</th>
                        <th class="orange">28</th>
                        <th class="magenta">29</th>
                        <th class="gray">30</th>
                        <th class="yellow">31</th>
                        <th class="gray">32</th>
                        <th colspan="4" class="black">Note Sequence</th>
                        <th class="black"></th>
                    </tr>
                    <tr>
                        <th colspan="14" class="black"></th>
                    </tr>
                </table>
                <br>
                <p style="font-style: italic">*4-beat anacrusis = Four unstressed notes played for the Defuser to get a
                    sense of the rhythm before the module starts tracking user input.</p>
            </div>
            <div class="page-footer relative-footer">Page 1 of 1</div>
        </div>
    </div>
</body>
</html>