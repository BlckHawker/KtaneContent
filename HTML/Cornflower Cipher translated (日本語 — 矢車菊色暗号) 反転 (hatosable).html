<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>反転矢車菊色暗号 — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        table {
            margin: 1em auto;
            border: none;
        }
        .nw {
            white-space: nowrap;
        }
        td.f, th.f, tr.f > td, tr.f > th {
            border: none;
        }
        table.big {
            margin-top: 0;
        }
        table.big svg {
            display: block;
        }
        table.big tr:not(.f) td:not(.f), table.big tr:not(.f) th:not(.f) {
            width: 1cm;
            height: 1cm;
            box-sizing: border-box;
            padding: 0;
            text-align: center;
        }
        span.p {
            display: inline-block;
            width:  .6cm;
            height: .6cm;
            background-repeat: no-repeat;
            background-size: cover;
            vertical-align: middle;
        }
        table.big span.p { display: block; margin: 0 auto; }

        span.p11 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p21 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p31 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p41 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p12 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p22 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p32 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p42 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="none"/></svg>'); }
        span.p13 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p23 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p33 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p43 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="none"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p14 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p24 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="none"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p34 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="none"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }
        span.p44 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width=".05" viewBox="-.5 -.5 2 2"><circle r=".3" fill="black"/><circle cx="1" r=".3" fill="black"/><circle cy="1" r=".3" fill="black"/><circle cx="1" cy="1" r=".3" fill="black"/></svg>'); }

        .dark span.p { filter: invert(85%); }

    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">反転矢車菊色暗号</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Ultimate Cipher.svg" class="diagram">
                <h2>モジュール詳細：反転矢車菊色暗号</h2>
                <p class="flavour-text">Centaureae cyanisは綺麗な色を持つ。</p>
                <p>モジュールは、3つのディスプレー、キーボード、2つの矢印、及び現在のページを表示するボタン(送信ボタン)で構成されている。</p>
                <p>右の矢印を押すと、次のページに移動できる。左の矢印を押すと前のページに移動できる。ページは全部で2ページある。</p>
                <p>め、シリアルナンバーの最初の文字を三十六進数の文字として取得し6桁の二進数に変換する。本マニュアルでは、この二進数の各ビットを右から「ビット1」、「ビット2」、「ビット4」、「ビット8」「ビット16」と表現している(ビット32は使用しない)。</p>

                <h3>ステップ1：卓球型ストラドリング・チェッカーボード暗号</h3>
                <p>本ステップの前に、ページ1の下のディスプレーと2ページの上のディスプレーの内容を連結させる。これを「コード化された単語」とする。また、ページ2の真ん中と下のディスプレーにある単語も必要であり、それぞれ、キーワード(KW)1、キーワード2と呼ぶ。</p>
                <p>このステップでは、二つのストラドリング・チェッカーボードを作成する。一枚はコード化された単語を長い数字の文字列に変換するために使用し、もう一枚はその数字を英字に変換するために使用する。</p>
                <p>1枚目のストラドリング・チェッカーボードを作るうえで、以下の数字を獲得する。</p>
                <ul>
                    <li>d1 = インジケーターの個数を6で割った余り</li>
                    <li>d2 = ポートの数を6で割った余り。これがd1と等しい場合、1を足して再度6で割った余りを求める。</li>
                </ul>
                <p>さらに、KW1から以下の手順でアルファベットキーを作成する。</p>
                <ul>
                    <li>キーワードから重複する英字を除外する(最初に出現したもののみ残す)。</li>
                    <li>アルファベット全体の文字列を用意し、キーワードにある英字を除外する。</li>
                    <li>ビット8が1の場合、キーワードの末尾にアルファベットの文字列を配置する。そうでない場合、キーワードの先頭にアルファベットの文字列を配置する。</li>
                </ul>
                <p>ストラドリング・チェッカーボードを作成するには、まず5段6列の表を用意する。列に0から5の番号を振る。1段目のセルは、d1の列とd2の列を除いて全て取り除く。残りの26セルをアルファベットキーで埋めていく。ビット16が1の場合、縦読み順(1列目を上から下に埋め、その後2列目以降に続く)の方向で埋める。そうでない場合、読み順(1段目を左から右に埋め、その後2段目以降に続く)の方向で埋める。</p>
                <p>さらに、1段目以外の段にも0から5の番号を振る。ただし、d1とd2は飛ばす。</p>

            </div>
            <div class="page-footer relative-footer">ページ 1/4</div>
        </div>

        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">反転矢車菊色暗号</span>
            </div>
            <div class="page-content">
                <p>ここから、コード化された単語の各英字を数字に変換していく。1段目にある英字はその列に振られている1桁の数字に変換する。それ以外の英字は、段番号、列番号の順に並べて変換する。</p>

                <p>次に、先程と同様に2枚目のストラドリング・チェッカーボードを作成する。ただし、以下の要素を変更する。</p>
                <ul>
                    <li>d1とd2ではなく、以下の数字を使用する。
                        <ul>
                            <li>d3 = バッテリーの個数を6で割った余り</li>
                            <li>d4 = 点灯したインジケーターの個数を6で割った余り。これがd3と等しい場合、1を足して再度6で割った余りを求める。</li>
                        </ul>
                    </li>
                    <li>KW1とビット8ではなく、KW2とビット2を使用してアルファベットキーを作成する。</li>
                    <li>ビット16ではなく、ビット4を使用して英字を埋める順番を決める。</li>
                </ul>

                <p>このストラドリング・チェッカーボードで数字を英字に戻す。最初の数字がd3またはd4の場合、1段目の対応する英字を使用する。そうでない場合、その次の桁と合わせてペアにする。ペア内の1つ目の数字を段、2つ目の数字を列に使用して英字を取得する。最後に1桁残った場合、それは無視する。</p>
                <p>完了すると、新たなキーワードのKW3を取得できる。</p>

                <h4 style="text-align:center">例</h4>
                <p style="text-align:center">
                    暗号化された単語: LPFOENYHO; ビット: 01111
                </p>
                <div style='display: flex; justify-content: space-around; gap: 2cm'>
                    <div style='text-align: center'>
                        <div>KW1: NEVER, d1 = 2, d2 = 0<br>ビット8 ⇒ NEVR + アルファベット<br>ビット16 ⇒ 読み順</div>
                        <table>
                            <tr class='f'><td> </td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr>
                            <tr><td class='f'> </td><td>N</td><td>#</td><td>E</td><td>#</td><td>#</td><td>#</td></tr>
                            <tr><td class='f'>1</td><td>V</td><td>R</td><td>A</td><td>B</td><td>C</td><td>D</td></tr>
                            <tr><td class='f'>3</td><td>F</td><td>G</td><td>H</td><td>I</td><td>J</td><td>K</td></tr>
                            <tr><td class='f'>4</td><td>L</td><td>M</td><td>O</td><td>P</td><td>Q</td><td>S</td></tr>
                            <tr><td class='f'>5</td><td>T</td><td>U</td><td>W</td><td>X</td><td>Y</td><td>Z</td></tr>
                        </table>
                        <div><span class='nw'>L → 40</span>, <span class='nw'>P → 43</span>, <span class='nw'>F → 30</span>, <span class='nw'>O → 42</span>, <span class='nw'>E → 2</span>, <span class='nw'>N → 0</span>, <span class='nw'>Y → 54</span>, <span class='nw'>H → 32</span>, <span class='nw'>O → 42</span></div>
                        <div>数字: 4043304220543242</div>
                    </div>
                    <div style='text-align: center'>
                        <div>KW2: NOTARY, d3 = 1, d4 = 0<br>ビット2 ⇒ NOTARY + アルファベット<br>ビット4 ⇒ 縦読み順</div>
                        <table>
                            <tr class='f'><td> </td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr>
                            <tr><td class='f'> </td><td>N</td><td>Y</td><td>#</td><td>#</td><td>#</td><td>#</td></tr>
                            <tr><td class='f'>2</td><td>O</td><td>B</td><td>F</td><td>J</td><td>P</td><td>V</td></tr>
                            <tr><td class='f'>3</td><td>T</td><td>C</td><td>G</td><td>K</td><td>Q</td><td>W</td></tr>
                            <tr><td class='f'>4</td><td>A</td><td>D</td><td>H</td><td>L</td><td>S</td><td>X</td></tr>
                            <tr><td class='f'>5</td><td>R</td><td>E</td><td>I</td><td>M</td><td>U</td><td>Z</td></tr>
                        </table>
                        <div><span class='nw'>40 → A</span>, <span class='nw'>43 → L</span>, <span class='nw'>30 → T</span>, <span class='nw'>42 → H</span>, <span class='nw'>20 → O</span>, <span class='nw'>54 → U</span>, <span class='nw'>32 → G</span>, <span class='nw'>42 → H</span></div>
                        <div>KW3: ALTHOUGH</div>
                    </div>
                </div>
            </div>
            <div class="page-footer relative-footer">ページ 2/4</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">反転矢車菊色暗号</span>
            </div>
            <div class="page-content">
                <h3>ステップ2: 連鎖回転暗号</h3>
                <div style='float: right; margin-left: 1cm'>
                    <h4 style="text-align:center">例</h4>
                    <p style="text-align:center">
                        暗号化された単語: KNQMKJ<br>
                        N = 8<br>
                        カエサル | サイクル | 残り<br>
                        J–K → Y | Y | KNQMK <br>
                        K–M → X | XY | KNQM <br>
                        M–Q → V | XYV | KNQ <br>
                        Q–N → C | CXYV | KN <br>
                        N–K → C | XYVCC | K <br>
                        K → K | CCKXYV | <br>
                        結果: CCKXYV
                    </p>
                </div>

                <p>ステップ1で取得した暗号化された単語とページ1の真ん中のディスプレーの数字Nを使用する。英字を使い切るまで、以下のステップを繰り返す。</p>
                <ul>
                    <li>単語の末尾にある英字を取得する。その後、この英字を単語から取り除く。</li>
                    <li>この英字を、現在の単語の末尾にある英字のアルファベット上の位置の数字だけ、カエサル暗号で後方に戻す(英字が残っていない場合、この手順は無視する)。</li>
                    <li>この英字を結果文字列の先頭に追加する。</li>
                    <li>結果文字列の末尾にある文字を先頭に移動させる。これをN回行う。</li>
                </ul>

                <h3>ステップ3: 省略版ブラインド・ポリュビオス暗号</h3>
                <p>このステップでは、ステップ1で取得した8文字の英単語のKW3と、ステップ2で取得した暗号化された単語が必要になる。</p>
                <p>以下の図形を使用する。</p>
                <div style='display: flex; justify-content: space-around'>
                    <div>
                        <table class='big' id='xx'>
                            <tr class='f'><td> </td><td>?</td><td>?</td><td>?</td><td>?</td></tr>
                            <tr><td class='f'>?</td><td><span class='p p11'></span></td><td><span class='p p21'></span></td><td><span class='p p31'></span></td><td><span class='p p41'></span></td></tr>
                            <tr><td class='f'>?</td><td><span class='p p12'></span></td><td><span class='p p22'></span></td><td><span class='p p32'></span></td><td><span class='p p42'></span></td></tr>
                            <tr><td class='f'>?</td><td><span class='p p13'></span></td><td><span class='p p23'></span></td><td><span class='p p33'></span></td><td><span class='p p43'></span></td></tr>
                            <tr><td class='f'>?</td><td><span class='p p14'></span></td><td><span class='p p24'></span></td><td><span class='p p34'></span></td><td><span class='p p44'></span></td></tr>
                        </table>
                    </div>
                    <div>
                        <table class='big'>
                            <tr class='f'><td> </td><td>1</td><td>2</td><td>3</td><td>4</td></tr>
                            <tr><td class='f'>1</td><td></td><td></td><td></td><td></td></tr>
                            <tr><td class='f'>2</td><td></td><td></td><td></td><td></td></tr>
                            <tr><td class='f'>3</td><td></td><td></td><td></td><td></td></tr>
                            <tr><td class='f'>4</td><td></td><td></td><td></td><td></td></tr>
                        </table>
                    </div>
                </div>
                <p>まず、省略版ポリュビオス正方形(右)をAからPの英字で埋める。KW3を用意し、キーワードから重複する英字(最初に出現したもののみ残す)とQからZの英字を除外する。残りの AからPの英字からKW3に含まれる英字を除いたものをアルファベット順に並べる。ビット1が1の場合、キーワードの末尾にアルファベットの文字列を配置する。そうでない場合、キーワードの先頭にアルファベットの文字列を配置する。この16文字を読み順でグリッド内に記入していく。</p>
            </div>
            <div class="page-footer relative-footer">ページ 3/4</div>
        </div>
        <div class="page page-bg-04">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">反転矢車菊色暗号</span>
            </div>
            <div class="page-content">
                <p>次に、ブラインド・ポリュビオス正方形(左)の段と列に番号を振る。列は、KW3の前半4文字に従って1から4の番号を振る。英字のアルファベット順に1から4の番号を振ること。複数回出現する英字については、左から右の順番で振る。同様に、キーワードの後半四文字に従って段にも1から4の番号を振る。</p>
                <p>暗号化された単語を<a href='./Braille translated (日本語 — 点字) (hatosable).html'>統一英語点字</a>表記にする(複語ではなく、英字一文字のコードを使用)。そして、点のパターンを上から縦に積み重ねる。</p>
                <p>2×2の点のパターンを一つの塊として新たな英字に変換する。上から12段分の点のみ実行すること。変換するには、ブラインド・ポリュビオス正方形内から点のパターンを探し、その段と列のラベルを取得し、省略版ポリュビオス正方形内の同じ段と列にある新たな英字を取得する。</p>
                <p>最後に、残った6段の点の右側の列に着目する。塗りつぶされた点があれば、同じ位置にある新たな英字をカエサル暗号で13前方に進める(ROT-13を適用する)。</p>
                <h4 style="text-align:center">例</h4>
                <div style='display: flex; justify-content: space-around'>
                    <div>
                        <p style="text-align:center">
                            ALTH → 1342<br>
                            OUGH → 3412
                        </p>
                        <table class='big'>
                            <tr class='f'><td> </td><td>1</td><td>3</td><td>4</td><td>2</td></tr>
                            <tr><td class='f'>3</td><td><span class='p p11'></span></td><td><span class='p p21'></span></td><td><span class='p p31'></span></td><td><span class='p p41'></span></td></tr>
                            <tr><td class='f'>4</td><td><span class='p p12'></span></td><td><span class='p p22'></span></td><td><span class='p p32'></span></td><td><span class='p p42'></span></td></tr>
                            <tr><td class='f'>1</td><td><span class='p p13'></span></td><td><span class='p p23'></span></td><td><span class='p p33'></span></td><td><span class='p p43'></span></td></tr>
                            <tr><td class='f'>2</td><td><span class='p p14'></span></td><td><span class='p p24'></span></td><td><span class='p p34'></span></td><td><span class='p p44'></span></td></tr>
                        </table>
                    </div>
                    <div>
                        <p style="text-align:center">
                            KW3: ALTHOUGH; ビット: 01111<br>
                            暗号化された単語: CCKXYV
                        </p>
                        <table class='big'>
                            <tr class='f'><td> </td><td>1</td><td>2</td><td>3</td><td>4</td></tr>
                            <tr><td class='f'>1</td><td>A</td><td>L</td><td>H</td><td>O</td></tr>
                            <tr><td class='f'>2</td><td>G</td><td>B</td><td>C</td><td>D</td></tr>
                            <tr><td class='f'>3</td><td>E</td><td>F</td><td>I</td><td>J</td></tr>
                            <tr><td class='f'>4</td><td>K</td><td>M</td><td>N</td><td>P</td></tr>
                        </table>
                    </div>
                    <div style='text-align: center;'>
                        <p>
                            <div style='display: inline-block; text-align: left'>
                                <span class='p p41'></span> → 段3列2 → F<br>
                                <span class='p p14'></span> → 段2列1 → G<br>
                                <span class='p p11'></span> → 段3列1 → E<br>
                                <span class='p p21'></span> → 段3列3 → I<br>
                                <span class='p p24'></span> → 段2列3 → C<br>
                                <span class='p p14'></span> → 段2列1 → G<br>
                                <span class='p p43'></span> → ROT-13 1 &amp; 2<br>
                                <span class='p p42'></span> → ROT-13 3<br>
                                <span class='p p24'></span> → ROT-13 6<br>
                            </div>
                        </p>
                        <p>ROT-13前 = FGEICG<br>ROT-13後 = STRICT</p>
                    </div>
                </div>

                <p>完了後、復号された単語を取得したら、それを送信する。入力を開始すると、全てのディスプレーが暗転し下のディスプレーに入力された文字が表示される。</p>
                <p>入力を消去するには、いずれかの矢印をクリックする。ページが移動し、入力した文字列が消去される。6文字を超える入力はできないようになっている。 </p>
                <p>入力に問題がなければ、「SUB」と書かれたボタンを押して、回答を送信する。ミスが記録された場合、モジュールの最初のページに戻るが、暗号の再生成はされない。</p>
            </div>
            <div class="page-footer relative-footer">ページ 4/4</div>
        </div>
    </div>
</body>
</html>